angular.module("storage",[]).factory("storage",["$parse","$window","$log",function(e,r,n){"use strict";var a="undefined"==typeof r.localStorage?void 0:r.localStorage,t={resolveValue:function(e,r){r=angular.toJson(angular.isDate(r)?"love-date-json"+r.toJSON():"[object RegExp]"===Object.prototype.toString.call(r)?"love-regexp-string"+r.toString():r),a.setItem(e,r)},parseValue:function(e){var r;try{r=angular.fromJson(e),"undefined"==typeof r&&(r="undefined"),"true"===r&&(r=!0),"false"===r&&(r=!1),-1!==r.indexOf("love-date-json")&&(r=r.replace("love-date-json",""),r=new Date(r)),-1!==r.indexOf("love-regexp-string")&&(r=r.split("/"),r=new RegExp(r[1],r[2]))}catch(a){n.info(a.message)}return r},inArray:function(e,r){if(angular.isArray(r)){var n=!1;return angular.forEach(r,function(r){angular.equals(e,r)&&(n=!0)}),n}},unique:function(e){if(angular.isArray(e)){var r={},n=[];return angular.forEach(e,function(e){r.hasOwnProperty(e)||(n.push(e),r[e]=1)}),n}}},u={set:function(e,r){a.getItem(e)&&a.removeItem(e);try{t.resolveValue(e,r)}catch(u){n.info(u.message)}},get:function(e){return t.parseValue(a.getItem(e))},remove:function(e){a.removeItem(e)},clear:function(){a.clear()},update:function(e,r,n){function a(e,r){var n=u.get(e);return angular.isNumber(n)?(n+=r,void u.set(e,n)):!1}function i(e){var r=u.get(e);if(angular.equals(r,!0))r=!1,u.set(e,r);else{if(!angular.equals(r,!1))return!1;r=!0,u.set(e,r)}}function o(e,r){var n=u.get(e);return angular.isArray(n)?(n=n.concat(r),void u.set(e,n)):!1}function s(e,r){var n=u.get(e);return!angular.isArray(n)||angular.isArray(r)?!1:(t.inArray(r,n)||n.push(r),void u.set(e,n))}function c(e,r){var n=u.get(e);if(!angular.isArray(n))return!1;for(;-1!==n.indexOf(r);){var a=n.indexOf(r);n.splice(a,1)}u.set(e,n)}function f(e){var r=u.get(e);return angular.isArray(r)?void u.set(e,t.unique(r)):!1}function l(e,r){var n=u.get(e);angular.isObject(n)&&angular.isObject(r)&&(angular.extend(n,r),u.set(e,n))}switch(e){case"$inc":a(r,n);break;case"$verse":i(r,n);break;case"$push":o(r,n);break;case"$addToSet":s(r,n);break;case"$pull":c(r,n);break;case"$unique":f(r);break;case"$extend":l(r,n)}},bindObjectReverse:{},bindObjectForward:{},bind:function(r,n,a,t){function i(){var t=r.$watch(function(){return u.get(a)},function(a){e(n).assign(r,a)},!0);e(a).assign(u.bindObjectReverse,t)}function o(){var t=r.$watch(function(){return e(n)(r)},function(e){u.set(a,e)},!0);e(n).assign(u.bindObjectForward,t)}switch(t){case"forward":o();break;case"reverse":i();break;default:o()}},unbind:function(r,n,a,t){function i(){e(a)(u.bindObjectReverse).apply()}function o(){e(n)(u.bindObjectForward).apply()}switch(t){case"forward":o();break;case"reverse":i();break;default:o()}}};return u}]);
//# sourceMappingURL=data:application/json;base64,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TUFDRixLQUFBLFVBQ0UsR0FDQSxNQUNGLFNBQ0UsTUFhbkIsT0FBQSIsImZpbGUiOiJzdG9yYWdlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzdG9yYWdlJywgW10pXHJcbiAgLmZhY3RvcnkoJ3N0b3JhZ2UnLCBbJyRwYXJzZScsJyR3aW5kb3cnLCAnJGxvZycsXHJcbiAgICAgIGZ1bmN0aW9uICgkcGFyc2UsICR3aW5kb3csICRsb2cpIHtcclxuICAgICAgXHQndXNlIHN0cmljdCc7XHJcblx0XHQvKipcclxuXHRcdCAqIEdsb2JhbCBWYXJzXHJcblx0XHQgKi9cclxuXHRcdHZhciBzdG9yYWdlID0gKHR5cGVvZiAkd2luZG93LmxvY2FsU3RvcmFnZSA9PT0gJ3VuZGVmaW5lZCcpID8gdW5kZWZpbmVkIDogJHdpbmRvdy5sb2NhbFN0b3JhZ2U7XHJcblx0XHR2YXIgcHJpdmF0ZU1ldGhvZHMgPSB7XHJcbiAgICAgICAgICAgIHJlc29sdmVWYWx1ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEYXRlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYW5ndWxhci50b0pzb24oXCJsb3ZlLWRhdGUtanNvblwiICsgdmFsdWUudG9KU09OKCkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBSZWdFeHBdJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBhbmd1bGFyLnRvSnNvbihcImxvdmUtcmVnZXhwLXN0cmluZ1wiICsgdmFsdWUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYW5ndWxhci50b0pzb24odmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9LFxyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogUGFzcyBhbnkgdHlwZSBvZiBhIHN0cmluZyBmcm9tIHRoZSBsb2NhbFN0b3JhZ2UgdG8gYmUgcGFyc2VkXHJcblx0XHRcdCAqIEBwYXJhbSByZXMgLSBhIHN0cmluZyB0aGF0IHdpbGwgYmUgcGFyc2VkIGZvciB0eXBlXHJcblx0XHRcdCAqIEByZXR1cm5zIHsqfSAtIHdoYXRldmVyIHRoZSByZWFsIHZhbHVlIG9mIHN0b3JlZCB2YWx1ZSB3YXNcclxuXHRcdFx0ICovXHJcblx0XHRcdHBhcnNlVmFsdWU6IGZ1bmN0aW9uIChyZXMpIHtcclxuXHRcdFx0XHR2YXIgdmFsO1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHR2YWwgPSBhbmd1bGFyLmZyb21Kc29uKHJlcyk7XHJcblx0XHRcdFx0XHRpZiAodHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdFx0XHRcdFx0dmFsID0gJ3VuZGVmaW5lZCc7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAodmFsID09PSAndHJ1ZScpIHtcclxuXHRcdFx0XHRcdFx0dmFsID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICh2YWwgPT09ICdmYWxzZScpIHtcclxuXHRcdFx0XHRcdFx0dmFsID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbC5pbmRleE9mKCdsb3ZlLWRhdGUtanNvbicpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwucmVwbGFjZSgnbG92ZS1kYXRlLWpzb24nLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IG5ldyBEYXRlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWwuaW5kZXhPZignbG92ZS1yZWdleHAtc3RyaW5nJykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBuZXcgUmVnRXhwKHZhbFsxXSwgdmFsWzJdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdFx0JGxvZy5pbmZvKGUubWVzc2FnZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiB2YWw7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRpbkFycmF5IDogZnVuY3Rpb24obmVlZGxlLGFycmF5KXsgIFxyXG4gICAgICAgICAgICAgICBpZihhbmd1bGFyLmlzQXJyYXkoYXJyYXkpKXtcclxuICAgICAgICAgICAgICAgXHQgIHZhciBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICBcdCAgICAgIGFuZ3VsYXIuZm9yRWFjaChhcnJheSwgZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgXHQgICAgICBcdCBpZihhbmd1bGFyLmVxdWFscyhuZWVkbGUsdmFsdWUpKXtcclxuICAgICAgICAgIFx0ICAgICAgXHQgXHRmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgIFx0ICAgICAgXHQgfVxyXG4gICAgICAgICAgXHQgICAgICB9KTtcclxuICAgICAgICAgIFx0ICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICAgICAgICAgICAgIH1cclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdHVuaXF1ZSA6IGZ1bmN0aW9uKGFycmF5KXtcclxuICAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc0FycmF5KGFycmF5KSl7XHJcblx0XHRcdFx0ICAgdmFyIHRtcCA9IHt9LCBkZXN0aW55ID0gW107XHJcblx0XHRcdFx0ICAgYW5ndWxhci5mb3JFYWNoKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7XHJcblx0XHRcdFx0ICAgICAgaWYoIXRtcC5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSkpIHtcclxuXHRcdFx0XHQgICAgICAgICBkZXN0aW55LnB1c2godmFsdWUpO1xyXG5cdFx0XHRcdCAgICAgICAgIHRtcFt2YWx1ZV0gPSAxO1x0XHJcblx0XHRcdFx0ICAgICAgfVx0XHRcdCAgIFx0XHJcblx0XHRcdFx0ICAgfSk7XHJcblx0XHRcdFx0ICAgcmV0dXJuIGRlc3Rpbnk7ICAgICAgICAgICAgICAgXHRcclxuICAgICAgICAgICAgICAgfVxyXG5cdFx0XHR9ICBcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIHB1YmxpY01ldGhvZHMgPSB7XHJcblx0XHRcdC8qKlxyXG5cdFx0XHQgKiBTZXQgLSBsZXQncyB5b3Ugc2V0IGEgbmV3IGxvY2FsU3RvcmFnZSBrZXkgcGFpciBzZXRcclxuXHRcdFx0ICogQHBhcmFtIGtleSAtIGEgc3RyaW5nIHRoYXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBhY2Nlc3NvciBmb3IgdGhlIHBhaXJcclxuXHRcdFx0ICogQHBhcmFtIHZhbHVlIC0gdGhlIHZhbHVlIG9mIHRoZSBsb2NhbFN0b3JhZ2UgaXRlbVxyXG5cdFx0XHQgKiBAZXhjZXB0aW9uIC0gdGhlIGxvY2Fsc3RvcmFnZSBoYXMgc2l6ZSBsaW1pdCAgXHJcblx0XHRcdCAqL1xyXG5cdFx0XHRzZXQ6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XHJcblx0XHRcdCAgIGlmKHN0b3JhZ2UuZ2V0SXRlbShrZXkpKXtcclxuXHRcdFx0XHQgICBzdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcdFxyXG5cdFx0XHQgICB9XHJcblxyXG5cdFx0XHQgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgcHJpdmF0ZU1ldGhvZHMucmVzb2x2ZVZhbHVlKGtleSwgdmFsdWUpO1xyXG5cdFx0XHQgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICRsb2cuaW5mbyhlLm1lc3NhZ2UpO1xyXG5cdFx0XHQgICB9XHJcblx0XHRcdCAgIFxyXG5cdFx0XHR9LFxyXG5cclxuXHRcdFx0LyoqXHJcblx0XHRcdCAqIEdldCAtIGxldCdzIHlvdSBnZXQgdGhlIHZhbHVlIG9mIGFueSBwYWlyIHlvdSd2ZSBzdG9yZWRcclxuXHRcdFx0ICogQHBhcmFtIGtleSAtIHRoZSBzdHJpbmcgdGhhdCB5b3Ugc2V0IGFzIGFjY2Vzc29yIGZvciB0aGUgcGFpclxyXG5cdFx0XHQgKiBAcmV0dXJucyB7Kn0gLSBPYmplY3QsU3RyaW5nLEZsb2F0LEJvb2xlYW4gZGVwZW5kaW5nIG9uIHdoYXQgeW91IHN0b3JlZFxyXG5cdFx0XHQgKi9cclxuXHRcdFx0Z2V0OiBmdW5jdGlvbiAoa2V5KSB7XHJcblx0XHRcdFx0cmV0dXJuIHByaXZhdGVNZXRob2RzLnBhcnNlVmFsdWUoc3RvcmFnZS5nZXRJdGVtKGtleSkpO1xyXG5cdFx0XHR9LFxyXG5cclxuXHRcdFx0LyoqXHJcblx0XHRcdCAqIFJlbW92ZSAtIGxldCdzIHlvdSBudWtlIGEgdmFsdWUgZnJvbSBsb2NhbFN0b3JhZ2VcclxuXHRcdFx0ICogQHBhcmFtIGtleSAtIHRoZSBhY2Nlc3NvciB2YWx1ZVxyXG5cdFx0XHQgKi9cclxuXHRcdFx0cmVtb3ZlOiBmdW5jdGlvbiAoa2V5KSB7XHJcblx0XHRcdFx0c3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogQ2xlYXIgQWxsIC0gbGV0J3MgeW91IGNsZWFyIG91dCBBTEwgbG9jYWxTdG9yYWdlIHZhcmlhYmxlcywgdXNlIHRoaXMgY2FyZWZ1bGx5IVxyXG5cdFx0XHQgKi9cclxuIFx0XHRcdGNsZWFyOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRzdG9yYWdlLmNsZWFyKCk7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHQvKiogVXBkYXRlIC0gQSBzaW1pbGFyIGZ1bmN0aW9uIHdpdGggc2V0IHRvIGF2b2lkIFFVT1RBX0VYQ0VFREVEX0VSUiBpbiBpcGhvbmUvaXBhZFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gbW9kaWZ5IC0gc2hvcnRoYW5kIG1ldGhvZFxyXG5cdFx0XHQgKiBAcGFyYW0gc3RvcmFnZUtleSAtIGEgc3RyaW5nIHRoYXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBhY2Nlc3NvciBmb3IgdGhlIHBhaXJcclxuXHRcdFx0ICogQHBhcmFtIHZhbHVlIC0gdGhlIHZhbHVlIG9mIHRoZSBsb2NhbFN0b3JhZ2UgaXRlbVxyXG5cdFx0XHQgKi9cclxuXHRcdFx0dXBkYXRlOmZ1bmN0aW9uKG1vZGlmeSwgc3RvcmFnZUtleSwgdmFsdWUpe1xyXG5cdFx0XHRcdHN3aXRjaChtb2RpZnkpe1xyXG5cdFx0XHRcdFx0Y2FzZSAnJGluYyc6XHJcblx0XHRcdFx0XHQgICAgaW5jKHN0b3JhZ2VLZXksIHZhbHVlKTtcclxuXHRcdFx0XHRcdCAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICckdmVyc2UnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJzZShzdG9yYWdlS2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSAnJHB1c2gnOlxyXG5cdFx0XHRcdFx0ICAgIHB1c2goc3RvcmFnZUtleSwgdmFsdWUpO1xyXG5cdFx0XHRcdFx0ICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJyRhZGRUb1NldCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFRvU2V0KHN0b3JhZ2VLZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnJHB1bGwnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWxsKHN0b3JhZ2VLZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlICckdW5pcXVlJzpcclxuXHRcdFx0XHRcdCAgICB1bmlxdWUoc3RvcmFnZUtleSk7XHJcblx0XHRcdFx0XHQgICAgYnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlICckZXh0ZW5kJzpcclxuXHRcdFx0XHRcdCAgICBleHRlbmQoc3RvcmFnZUtleSwgdmFsdWUpO1xyXG5cdFx0XHRcdFx0ICAgIGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0ZnVuY3Rpb24gaW5jKHN0b3JhZ2VLZXksIHZhbHVlKXtcclxuXHRcdFx0XHRcdHZhciBzdG9yYWdlVmFsdWUgPSBwdWJsaWNNZXRob2RzLmdldChzdG9yYWdlS2V5KTtcclxuXHRcdFx0XHRcdGlmIChhbmd1bGFyLmlzTnVtYmVyKHN0b3JhZ2VWYWx1ZSkpe1xyXG5cdFx0XHRcdCAgICAgIHN0b3JhZ2VWYWx1ZSArPXZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgcHVibGljTWV0aG9kcy5zZXQoc3RvcmFnZUtleSwgc3RvcmFnZVZhbHVlKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdmVyc2Uoc3RvcmFnZUtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlVmFsdWUgPSBwdWJsaWNNZXRob2RzLmdldChzdG9yYWdlS2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMoc3RvcmFnZVZhbHVlLCB0cnVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlVmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljTWV0aG9kcy5zZXQoc3RvcmFnZUtleSwgc3RvcmFnZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuZXF1YWxzKHN0b3JhZ2VWYWx1ZSwgZmFsc2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpY01ldGhvZHMuc2V0KHN0b3JhZ2VLZXksIHN0b3JhZ2VWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblx0XHRcdFx0ZnVuY3Rpb24gcHVzaChzdG9yYWdlS2V5LCB2YWx1ZSl7XHJcblx0XHRcdFx0XHR2YXIgc3RvcmFnZVZhbHVlID0gcHVibGljTWV0aG9kcy5nZXQoc3RvcmFnZUtleSk7XHJcblx0XHRcdFx0XHRpZihhbmd1bGFyLmlzQXJyYXkoc3RvcmFnZVZhbHVlKSl7XHJcblx0XHRcdFx0XHQgICAgc3RvcmFnZVZhbHVlID0gc3RvcmFnZVZhbHVlLmNvbmNhdCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpY01ldGhvZHMuc2V0KHN0b3JhZ2VLZXksIHN0b3JhZ2VWYWx1ZSk7XHJcblx0XHRcdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0ZnVuY3Rpb24gYWRkVG9TZXQoc3RvcmFnZUtleSwgdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlVmFsdWUgPSBwdWJsaWNNZXRob2RzLmdldChzdG9yYWdlS2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KHN0b3JhZ2VWYWx1ZSkgJiYgIWFuZ3VsYXIuaXNBcnJheSh2YWx1ZSkpe1xyXG5cdFx0ICAgICAgICAgICAgICAgIGlmICghcHJpdmF0ZU1ldGhvZHMuaW5BcnJheSh2YWx1ZSwgc3RvcmFnZVZhbHVlKSkge1xyXG5cdFx0ICAgICAgICAgICAgICAgICAgICBzdG9yYWdlVmFsdWUucHVzaCh2YWx1ZSk7XHJcblx0XHQgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNNZXRob2RzLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG5cdCAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cdCAgICAgICAgICAgICAgICB9ICAgICBcclxuXHRcdFx0XHR9XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcHVsbChzdG9yYWdlS2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlVmFsdWUgPSBwdWJsaWNNZXRob2RzLmdldChzdG9yYWdlS2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZihhbmd1bGFyLmlzQXJyYXkoc3RvcmFnZVZhbHVlKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdG9yYWdlVmFsdWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBzdG9yYWdlVmFsdWUuaW5kZXhPZih2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlVmFsdWUuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNNZXRob2RzLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHRcdFx0XHRmdW5jdGlvbiB1bmlxdWUoc3RvcmFnZUtleSl7XHJcblx0XHRcdFx0XHR2YXIgc3RvcmFnZVZhbHVlID0gcHVibGljTWV0aG9kcy5nZXQoc3RvcmFnZUtleSk7XHJcblx0XHRcdFx0XHRpZihhbmd1bGFyLmlzQXJyYXkoc3RvcmFnZVZhbHVlKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNNZXRob2RzLnNldChzdG9yYWdlS2V5LHByaXZhdGVNZXRob2RzLnVuaXF1ZShzdG9yYWdlVmFsdWUpKTtcclxuXHRcdFx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRmdW5jdGlvbiBleHRlbmQoc3RvcmFnZUtleSx2YWx1ZSl7XHJcblx0XHRcdFx0XHR2YXIgc3RvcmFnZVZhbHVlID0gcHVibGljTWV0aG9kcy5nZXQoc3RvcmFnZUtleSk7XHJcblx0XHRcdFx0XHRpZihhbmd1bGFyLmlzT2JqZWN0KHN0b3JhZ2VWYWx1ZSkgJiYgYW5ndWxhci5pc09iamVjdCh2YWx1ZSkpe1xyXG5cdFx0XHRcdFx0XHRhbmd1bGFyLmV4dGVuZChzdG9yYWdlVmFsdWUsIHZhbHVlKTtcclxuXHRcdFx0XHRcdFx0cHVibGljTWV0aG9kcy5zZXQoc3RvcmFnZUtleSxzdG9yYWdlVmFsdWUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdFxyXG5cdFx0XHQgLypcclxuXHRcdFx0ICAgIEEgb2JqZWN0IHRvIHN0b3JlIGNhbmNlbCBmdW5jdGlvbnMgdGhhdCBnZW5lcmF0ZSB3aGVuIGFwcGx5ICRzY29wZS4kd2F0Y2hcclxuXHRcdFx0ICAgIGZvciB1bm5lY2Vzc2FyeSBqdWRnZSwgc3RvcmUgdGhlIGZ1bmN0aW9ucyBzZXBlcmF0ZVxyXG5cdFx0XHQgKi9cclxuICAgICAgICAgICAgXCJiaW5kT2JqZWN0UmV2ZXJzZVwiIDoge30sXHJcblxyXG4gICAgICAgICAgICBcImJpbmRPYmplY3RGb3J3YXJkXCIgOiB7fSxcclxuXHJcblx0XHRcdC8qKiBCaW5kIC0gTWFrZSBhIGRhdGEtYmluZGluZyBpbiBzaW5nbGUgd2F5IG9yIGJvdGggd2F5XHJcblx0XHRcdCAqIEBwYXJhbSAkc2NvcGUgLSB0aGlzIHBhcmFtIGlzIHRvIGluamVjdCAkc2NvcGUgZW52aXJvbm1lbnQgaW4gbXkgb3duIG9waW5pb25cclxuXHRcdFx0ICogQHBhcmFtIG1vZGVsS2V5IC0gYW5ndWxhciBleHByZXNzaW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGdldCB2YWx1ZSBmcm9tIHRoZSAkc2NvcGUgXHJcblx0XHRcdCAqIEBwYXJhbSBzdG9yYWdlS2V5IC0gdGhlIG5hbWUgb2YgdGhlIGxvY2FsU3RvcmFnZSBpdGVtXHJcblx0XHRcdCAqIEBwYXJhbSBkaXJlY3Rpb24gLSBkYXRhLWJpbmRpbmcgZGlyY3Rpb24gLCBmcm9tIG1vZGVsIHRvIGxvY2Fsc3RvcmFnZSBvciBmcm9tIGxvY2Fsc3RvcmFnZSB0byBcclxuXHRcdFx0ICAgICAgICAgICAgICAgICAgICAgIG1vZGVsIG9yIGJvdGggd2F5IFxyXG5cclxuXHRcdFx0ICovXHJcblx0XHRcdGJpbmQ6IGZ1bmN0aW9uKCRzY29wZSwgbW9kZWxLZXksIHN0b3JhZ2VLZXksIGRpcmVjdGlvbil7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgY2FzZSAnZm9yd2FyZCcgOlxyXG4gICAgICAgICAgICAgICAgICAgICBmb3J3YXJkQmluZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JldmVyc2UnIDpcclxuICAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZUJpbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgICAgICAgICAgICAgICAgZm9yd2FyZEJpbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgYnJlYWs7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblx0XHRcdFx0ZnVuY3Rpb24gcmV2ZXJzZUJpbmQoKXtcclxuXHRcdFx0XHRcdHZhciB0bXAgPSAkc2NvcGUuJHdhdGNoKFxyXG5cdFx0XHRcdFx0XHRcdGZ1bmN0aW9uICgpe1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHB1YmxpY01ldGhvZHMuZ2V0KHN0b3JhZ2VLZXkpO1xyXG5cdFx0XHRcdFx0XHRcdH0sXHJcblx0XHQgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKG5ld1ZhbCl7XHJcblx0XHQgICAgICAgICAgICAgICAgICAgICAgICRwYXJzZShtb2RlbEtleSkuYXNzaWduKCRzY29wZSwgbmV3VmFsKTtcclxuXHRcdCAgICAgICAgICAgICAgICAgICAgfSxcclxuXHRcdCAgICAgICAgICAgICAgICAgICAgdHJ1ZVxyXG5cdFx0XHRcdFx0XHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkcGFyc2Uoc3RvcmFnZUtleSkuYXNzaWduKHB1YmxpY01ldGhvZHMuYmluZE9iamVjdFJldmVyc2UsIHRtcCk7XHRcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGZ1bmN0aW9uIGZvcndhcmRCaW5kKCl7XHJcblx0XHRcdFx0XHR2YXIgdG1wID0gJHNjb3BlLiR3YXRjaChcclxuXHRcdFx0XHRcdFx0XHRmdW5jdGlvbigpe1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuICRwYXJzZShtb2RlbEtleSkoJHNjb3BlKTtcclxuXHRcdFx0XHRcdFx0XHR9LFxyXG5cdFx0ICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihuZXdWYWwpe1xyXG5cdFx0ICAgICAgICAgICAgICAgICAgICBcdHB1YmxpY01ldGhvZHMuc2V0KHN0b3JhZ2VLZXksIG5ld1ZhbCk7XHJcblx0XHQgICAgICAgICAgICAgICAgICAgIH0sXHJcblx0XHQgICAgICAgICAgICAgICAgICAgIHRydWVcclxuXHRcdFx0XHRcdFx0KTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuXHRcdFx0XHRcdCRwYXJzZShtb2RlbEtleSkuYXNzaWduKHB1YmxpY01ldGhvZHMuYmluZE9iamVjdEZvcndhcmQsIHRtcCk7XHJcblx0XHRcdFx0fVx0XHRcdFx0XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHQvKiogdW5iaW5kIC0gY2FuY2VsIGRhdGEtYmluZGluZyBpbiBzaW5nbGUgd2F5IG9yIGJvdGggd2F5XHJcblx0XHRcdCAqIEBwYXJhbSAkc2NvcGUgLSB0aGlzIHBhcmFtIGlzIHRvIGluamVjdCAkc2NvcGUgZW52aXJvbm1lbnQgaW4gbXkgb3duIG9waW5pb25cclxuXHRcdFx0ICogQHBhcmFtIG1vZGVsS2V5IC0gYW5ndWxhciBleHByZXNzaW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGdldCB2YWx1ZSBmcm9tIHRoZSAkc2NvcGUgXHJcblx0XHRcdCAqIEBwYXJhbSBzdG9yYWdlS2V5IC0gdGhlIG5hbWUgb2YgdGhlIGxvY2FsU3RvcmFnZSBpdGVtXHJcblx0XHRcdCAqIEBwYXJhbSBkaXJlY3Rpb24gLSBkYXRhLWJpbmRpbmcgY2FuY2VsIGRpcmVjdGlvbiAsIGZyb20gbW9kZWwgdG8gbG9jYWwgc3RvcmFnZSBvciBmcm9tIGxvY2FsIHN0b3JhZ2UgdG9cclxuXHRcdFx0ICAgICAgICAgICAgICAgICAgICAgIG1vZGVsIG9yIGJvdGggd2F5IFxyXG5cclxuXHRcdFx0ICovXHJcblx0XHRcdHVuYmluZCA6IGZ1bmN0aW9uKCRzY29wZSwgbW9kZWxLZXksIHN0b3JhZ2VLZXksIGRpcmVjdGlvbil7XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvcndhcmQnIDpcclxuICAgICAgICAgICAgICAgICAgICAgZm9yd2FyZFVuYmluZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JldmVyc2UnIDpcclxuICAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZVVuYmluZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICBicmVhazsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICAgICAgICAgICAgICAgICBmb3J3YXJkVW5iaW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlVW5iaW5kKCl7XHJcbiAgICAgICAgICAgICAgIFx0ICAkcGFyc2Uoc3RvcmFnZUtleSkocHVibGljTWV0aG9kcy5iaW5kT2JqZWN0UmV2ZXJzZSkuYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgZnVuY3Rpb24gZm9yd2FyZFVuYmluZCgpe1xyXG4gICAgICAgICAgICAgICBcdCAgJHBhcnNlKG1vZGVsS2V5KShwdWJsaWNNZXRob2RzLmJpbmRPYmplY3RGb3J3YXJkKS5hcHBseSgpO1xyXG4gICAgICAgICAgICAgICB9XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0XHRyZXR1cm4gcHVibGljTWV0aG9kcztcclxuXHR9XSk7ICBcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9